# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар
```

interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: categoryType;
  price: number | null;
}
```

Интерфейс модели данных
```

interface IAppState {
  catalog: IItem[];
  basket: string[];
  preview: string | null;
  order: IOrder | null;
}
```

Интерфейс для модального окна оформления заказа с выбором способа оплаты и вводом адреса 
```
interface IOrderForm {
  paymentMethod: string;
  address: string;
}
```

Интерфейс для модального окна с контактными данными 
```
interface IContactForm {
  email: string;
  phone: string;
}
```

Интерфейс с общей информацией о заказе
```
interface IOrder extends IPlacingOrder, IContactForm {
  items: string[]
}
```

Интерфейс с данными ответа сервера о заказе
```
interface IOrderMade {
  id: string;
  total: number;
}
```

Интерфейс с данными в корзине 
```
interface IBasketView {
    items: HTMLElement[];
    total: number;
    selected: string[];
}
```


## Архитектура приложения

Код проекта структурирован по парадигме MVP (Model-View-Presenter) и состоит из 3 слоев: 

 1 Model (Модель данных) - отвечает за хранение данных
 2 View (Представление) - отвечает за отображение данных
 3 Presenter (Презентер) -  отвечает за связь между представлением и данными.

## Базовый код

### Класс API

Класс для взаимодействия с сервером, содержит логику отправки запросов

Содержит следующие свойства и методы:

- Свойства:
 1. baseUrl - базовый адрес сервера
 2. options - объект с дополнительными настройками запроса

`constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

- Методы:
 1. get() - выполняет запрос и возвращает ответ с сервера
 2. post() - используется для отправки данных на сервер
 3. delete() - запрос для удаления данных
 4. handleResponse() - обработка ответа от сервера


### Класс EventEmitter

Класс используется для организации событий. С его помощью реализуется возможность отправить и подписаться на событие.

type EventName = string | RegExp;
type Subscriber = Function;
type EmitterEvent = {
    eventName: string,
    data: unknown
}

interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}

Содержит следующие свойства и методы

- Свойства
1. _events - Внутреннее хранилище всех событий и подписанных на них функций 

`constructor()` - инициализирует внутреннее хранилище событий _events, используемое для управления подписками и рассылкой событий по шаблонам или конкретным именам

- Методы:
1. on() - Подписывает обработчик на указанное событие или шаблон.
2. off() - Удаляет ранее установленный обработчик события.
3. emit() - Вызывает все обработчики, подписанные на событие или подходящие под шаблон.
4. onAll() - Подписывает обработчик на все события приложения.
5. offAll() - Удаляет все обработчики всех событий.
6. trigger() - Возвращает функцию, которая при вызове отправляет событие. Удобно использовать как коллбек в компонентах.

### Слой данных 

#### Класс AppState 

Данный класс используется для общего управления состоянием проекта

Содержит следующие свойства и методы

- Свойства
1. catalog: IItem[] - массив карточек с товарами 
2. basket: string[]  - массив выбранных товаров в корзине 
3. preview: string | null - используется для предпросмотра, содержит ID товара  
4. order: IOrder | null - объект, содержащий информацию о покупаемых товарах, контактных данных покупателя, способе оплаты и адреса доставки

`constructor(events: IEvents)` - принимает экземпляр класса событий для связи с другими частями приложения

- Методы:
1. deleteBasketItem() - удалить элемент из корзины
2. addBasketItem() - добавить элемент в корзину
3. clearBasket() - очистить корзину
4. sumTotalBasketPrice - общая сумма всех товаров в корзине
5. openItem() - открыть карточку товара
6. validateOrderForm() - валидация поля адреса
7. validateContactForm() - валидация поля ввода контактных данных
8. formErrors() - для ошибок в формах

### Слой представления

### Класс Component
Базовый класс для всех компонентов интерфейса, связанных с DOM. Предоставляет методы для работы с DOM-элементами: скрытие, показ, управление текстом, атрибутами, классами и слушателями событий.

-Поля класса:
1. container - DOM-элемент компонента

`constructor(container: HTMLElement)` - принимает DOM-элемент, который управляется этим компонентом.

-Методы класса:
1. toggleClass() - переключение класса у необходимых элементов
2. setText() - установка текста
3. setDisabled() - изменение статуса disabled 
4. setHidden() - скрытие элемента
5. setImage() - установка изображения
6. setVisible() - показ элемента
7. render() - рендер


#### Класс Modal

Используется для реализации модального окна. Предназначен для использования методов open и close. Также принимает селектор по которому идентифицируется нужное модальное окно

-Поля класса:
1. modal - для элементов модального окна
2. events - брокер событий

`constructor(container: HTMLElement, events: IEvents)` - принимает DOM-элемент модального окна и экземпляр класса событий для взаимодействия с системой событий

-Методы класса:
1. open() - открытие модального окна
2. close() - закрытие модального окна


#### Класс Basket

Расширяет класс Modal. Используется для реализации модального окна с корзиной.

-Поля класса:
1. total - общая стоимость товаров
2. items - перечень товаров в корзине

`constructor(container: HTMLElement, events: IEvents)` - принимает DOM-элемент модального окна корзины и экземпляр класса событий для связи с другими компонентами

-Методы класса:
1. set total - установка общей стоимости товаров
2. set items - установка перечня товаров в корзине


#### Класс OrderForm

Расширяет класс Modal. Используется для реализации модального окна с выбором способа оплаты и вводом адреса доставки

-Поля класса:
1. btnPaymentOnline - кнопка онлайн способа оплаты 
2. btnPaymentCash - кнопка оплаты при получении
3. deliveryAddress - поле ввода адреса

`constructor(container: HTMLElement, events: IEvents)` - принимает DOM-элемент модального окна и экземпляр класса событий для отслеживания ввода адреса и способа оплаты

-Методы класса:
1. set payment - установка и выбор способа оплаты
2. set address - установка адреса доставки


#### Класс ContactForm 

Расширяет класс Modal. Используется для реализации модального окна с формой ввода контактных данных покупателя 

Содержит следующие поля и методы:

-Поля класса:
1. emailInput - поле для ввода адреса электронной почты
2. phoneInput - поле для ввода номера телефона

`constructor(container: HTMLElement, events: IEvents)` - принимает DOM-элемент формы и экземпляр класса событий для обработки ввода контактных данных

-Методы класса:
1. set email - установка адреса электронной почты
2. set phone - установка номера телефона


#### Класс Success
Расширяет класс Modal. Используется для реализации модального окна, которое сообщает о успешном оформлении заказа

Содержит следующие поля и методы:

-Поля класса:
1. total - общая стоимость приобретенных товаров

`constructor(container: HTMLElement, events: IEvents)` — принимает DOM-элемент окна и экземпляр класса событий для отображения информации об успешном заказе

-Методы класса:
1. set total - установка значения общей стоимость приобретенных товаров


#### Класс Page

Управляет глобальным состоянием страницы и отображением ключевых элементов интерфейса

Содержит следующие поля и методы:

-Поля класса:
1. wrapper - обертка всей страницы, используется для визуальной блокировки при открытии модального окна
2. counter - визуальный счетчик количества товаров в корзине
3. catalog - каталог товаров
4. basket - корзина

`constructor(container: HTMLElement, catalog: HTMLElement, counter: HTMLElement)` — принимает DOM-элементы страницы, каталога товаров и счётчика корзины для управления интерфейсом

-Методы класса:
1. set lock - блокирует или разблокирует интерфейс страницы
2. set counter - реализует функцию счетчика для товаров в корзине


#### Класс Item

Данный класс отвечает за отображение карточки с товаром/продуктом в приложении. Он принимает всю информацию о товаре: название, изображение, цену и описание. Каждая карточка товара включает кнопку для добавления товара в корзину. 

Содержит следующие поля и методы:

-Поля класса:
1. _id - id карточки
2. _description - описание товара
3. _image - картинка
4. _title - наименование
5. _category - категория товара
6. _price - цена
7. btn - кнопка карточки 

`constructor(container: HTMLElement, events: IEvents)` — принимает DOM-элемент карточки товара и экземпляр класса событий для обработки взаимодействия с карточкой.

Класс использует следующие методы управления
-Методы класса:
1. id - методы управления id 
 1.1 set id
 1.2 get id
2. set description - методы управления описанием
3. set image
4. title - методы   управления наименованием
 4.1 set title
 4.2 get title 
5. category - методы управления категорией товара
 5.1 set category
 5.2 get category
6. price - методы управления ценой
 5.1 set price
 5.2 get price
7. set btn - метод управления кнопкой (установка названия)


### Слой коммуникаций 

#### Класс AppApi
Класс AppApi предназначен для взаимодействия проекта с сервером. Используется для получения и отправки данных, необходимых для функционирования приложение

`constructor(baseUrl: string, options: RequestInit = {})` — принимает базовый URL API и глобальные параметры для отправки HTTP-запросов (опционально)


Использует следующие методы
1. getItemList - метод для получения информации о товаре
2. orderItems - отправка запроса с данными о заказе. Используется при оформлении покупки для передачи информации о сделанном заказе. 

## Взаимодействие компонентов

Взаимодействие внутри приложения реализовано через событийную модель. Компоненты модели (Model) инициируют события, на которые подписаны слушатели в основном коде (Presenter). Эти слушатели обрабатывают данные, при необходимости выполняют промежуточные вычисления, изменяют состояние модели и передают данные представлению (View). Такой подход обеспечивает слабую связанность компонентов и гибкость архитектуры.

### Список всех событий, которые возникают при взаимодействии пользователя с интерфейсом

items:changed - изменение данных каталога \
item:select - выбор карточки для ее открытия \
preview:changed - просмотр карточки \
item:add - добавление товара в корзине \
item:delete - удаление товара из корзины \
basket:open - открытие корзины \
modal:close - закрытие модальных окон \
order:open - открытие заказа \
orderForm:input - изменение данных в форме доставки \
orderForm:submit - отправка данных в форме доставки \
order:submit - отправка заказа \
contactForm:input - изменение данных в форме ввода контактных данных \
email:submit - отправка данных в форме ввода контактных данных \
form:validation - валидация форм \
paymentMethod: select - выбор способа оплаты в форме ввода данных о заказе 